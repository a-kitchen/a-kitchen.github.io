<html>
<head>
<title>a-kitchen</title>
</head>
<body>
<h1>a-kitchen</h1>
<br>
<input id="name" type="text" size=17 placeholder="Device Name">
<button type="button" onclick="search()">sraech</button>
<p id= "demo"> 123456789 </p>
<p  id = "conn"> fals</p>
<p id = "service">Servicefals</p>
<p id = "data">DATA</p>
<script>

function search(){
	document.getElementById("demo").innerHTML="My First JavaScript";
	let options = {
	optionalServices:['00000000-0000-1000-8000-00805f9b34fb'],
	optionalServices:['00000001-0000-1000-8000-00805f9b34fb'],
	optionalServices:['00000002-0000-1000-8000-00805f9b34fb'],
	optionalServices:['00000003-0000-1000-8000-00805f9b34fb'],
	};
	let filters = [];
	let filterName = document.querySelector('#name').value;
  if (filterName) {
    filters.push({name: filterName});
	 options.filters = filters;
  }else{
  options.acceptAllDevices = true;
  }
  

  
	navigator.bluetooth.requestDevice(options).then(device => {
	return	device.gatt.connect();
	
		       }).then(server => {
				document.getElementById("service").innerHTML="trurservcice";
			
			 return server.getPrimaryService('00000000-0000-1000-8000-00805f9b34fb');
			}).then(service => {
			
			return Promise.all([
	              service.getCharacteristic('00000002-0000-1000-8000-00805f9b34fb'),
				  service.getCharacteristic('00000003-0000-1000-8000-00805f9b34fb').then(read)
			]);
	
             }).catch(error => {
			document.getElementById("demo").innerHTML="error"+error;
			});
	
}

function read(characteristic){
    return characteristic.startNotifications() 
    .then(char => {
	   characteristic.addEventListener('characteristicvaluechanged',
                                    onHeartRateChanged);
    });
}

function onHeartRateChanged(event) {
  let characteristic = event.target;
  console.log(parseHeartRate(characteristic.value));
  document.getElementById("data").innerHTML="D"+characteristic.value;
}

</script>

<br>
<button type="button" onclick="getServices()">get Service</button>
<br>
<button type="button" onclick="startNo()">startNotifications</button>
<br>
<button type="button" onclick="stopNo()">stopNotifications</button>
<br>
<button type="button" onclick="read()">read</button>
<br>
<button type="button" onclick="write()">write</button>
<br>

<p>Links
<ul>
<li><a href="https://googlechrome.github.io/samples/web-bluetooth/">Web Bluetooth Samples</a>
<li><a href="https://github.com/WebBluetoothCG">Web Bluetooth Community Group</a>
</ul>
</body>
<script src="inspect.js"></script>
</html>

